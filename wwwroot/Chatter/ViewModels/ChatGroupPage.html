<link href="/Chatter/css/chatter.css" rel="stylesheet" />
        
<template>
    <template is="dom-bind">
        <h2 class="group-name">{{model.Name}}</h2>
        <div class="group-back-button">
            <a href="/chatter" class="btn btn-default btn-sm">Go back</a>
        </div>
        <div class="group-user">
            <template is="dom-if" if="{{model.UserKey}}">
                Signed in as
                <b>{{model.UserName$}}</b>
            </template>
            <template is="dom-if" if="{{!model.UserKey}}">
                You are not signed in, you messages will be send anonymously
            </template>
        </div>
        <div class="group-messages">
            <template is="dom-repeat" items="{{model.ChatMessagePages}}">
                <starcounter-include partial="{{item}}"></starcounter-include>
            </template>
        </div>
        <div class="group-message-title">
            Message
        </div>
        <div class="group-attachment-title">
            Attachments
        </div>
        <div class="group-message">
            <input type="text" value="{{model.ChatMessage.Text$::input}}" on-keyup="onInputKeyup" class="form-control" placeholder="Input your message" />
        </div>
        <div class="group-attachment">
            <input type="text" class="form-control" value="{{model.AttachmentSearch$::input}}" on-blur="clearFoundAttachments" placeholder="Type to find an attachent" />
            <template is="dom-if" if="{{model.FoundAttachment.length}}">
                <ul class="autocomplete">
                    <template is="dom-repeat" items="{{model.FoundAttachment}}">
                        <li>
                            <button type="button" class="btn btn-sm btn-link" onmousedown="++this.value;" value="{{item.Choose$::click}}">{{item.NameAndType}}</button>
                        </li>
                    </template>
                </ul>
            </template>
        </div>
        <div class="group-attachments">
            <table class="table">
                <template is="dom-repeat" items="{{model.ChatMessage.ChatAttachments}}">
                    <tr>
                        <td>
                            <span>{{item.Attachment.Name}}</span> - <span>{{item.Attachment.Type}}</span>
                        </td>
                        <td>
                            <button type="button" class="btn btn-default btn-xs" onclick="++this.value;" value="{{item.Delete$::click}}">Remove</button>
                        </td>
                    </tr>
                </template>
            </table>
        </div>
        <div class="group-warning">
            <template is="dom-if" if="{{model.Warning}}">
                <span>{{model.Warning}}</span>
            </template>
        </div>
        <div class="group-send">
            <button class="btn btn-primary" onclick="++this.value;" value="{{model.Send$::click}}">Send</button>
        </div>
        <div class="group-send-title">Press enter to send message</div>
        <dom-bind-notifier observed-object="{{model}}" path="model" deep></dom-bind-notifier>
    </template>
    <script>
        (function init() {
            var template = (document._currentScript || document.currentScript).previousElementSibling;

            template.onInputKeyup = function (e) {
                if (e.keyCode == 13) {
                    template.set("model.Send$", template.model.Send$ + 1);
                }
            };

            template.clearFoundAttachments = function () {
                setTimeout(function () {
                    template.set("model.ClearFoundAttachments$", template.model.ClearFoundAttachments$ + 1);
                }, 100);
            };
        })();
    </script>
</template>
